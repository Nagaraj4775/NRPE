---

- name: "Create Host Directory on Nagios Server"
  #delegate_to: "{{ item.name }}"
  file:
    path:   "{{ nagios_host_path }}"
    state:  directory
    force:  yes
    owner:  "{{ nagios_server_user }}"
    group:  "{{ nagios_server_group }}"
    mode:   '0755'
    seuser: system_u
    serole: object_r
    setype: nrpe_etc_t
  when: inventory_hostname in groups['nserver']
  #notify:
  # - Reload Nagios

- name: "Service Definitions on Nagios Server"
  #delegate_to: "{{ item.name }}"
  template:
#    src:    "etc/nagios/objects/{{ item.1.src }}.j2"
    src:    "{{ item.1.src }}.j2"
    dest:   "{{ nagios_objects_path }}/{{ item.1.dest }}"
    force:  yes
    owner:  "{{ nagios_server_user }}"
    group:  "{{ nagios_server_group }}"
    mode:   '0644'
    seuser: system_u
    serole: object_r
    setype: nrpe_etc_t
  with_nested:
   - '{ src: Nagios-ServerSide-Files/groups/basic.cfg,         dest: "ansible-shards/0-groups-basic.cfg" }'
   - '{ src: Nagios-ServerSide-Files/hosts/templates.cfg,      dest: "hosts/{{ ansible_hostname }}/templates.cfg" }'
   - '{ src: Nagios-ServerSide-Files/hosts/host.cfg,           dest: "hosts/{{ ansible_hostname }}/host.cfg" }'
   - '{ src: Nagios-ServerSide-Files/hosts/service-basics.cfg, dest: "hosts/{{ ansible_hostname }}/service-basics.cfg" }'
  when: inventory_hostname in groups['nserver']
  #notify:
  # - Reload Nagios
